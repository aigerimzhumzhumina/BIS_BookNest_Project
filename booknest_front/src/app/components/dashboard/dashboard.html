<app-header></app-header>

<div class="dashboard-container">
  @if (currentUser) {
    <div class="dashboard-content">
      <!-- User Profile Section -->
      <section class="profile-section">
        <div class="profile-header">
          <h1>{{ 'dashboard.myProfile' | translate }}</h1>
          <button class="btn-edit" (click)="toggleEditMode()">
            @if (isEditMode) {
              <span>{{ 'dashboard.cancel' | translate }}</span>
            } @else {
              <span>{{ 'dashboard.edit' | translate }}</span>
            }
          </button>
        </div>

        <div class="profile-card">
        <!----  <div class="avatar-section">
            <img [src]="isEditMode ? editUser.avatar : currentUser.avatar" 
                 [alt]="currentUser.username" 
                 class="avatar">
            @if (isEditMode) {
              <label class="avatar-upload">
                <input type="file" accept="image/*" (change)="onAvatarChange($event)">
                <span>Change photo</span>
              </label>
            }
          </div> --->
          

          <div class="profile-info">
            @if (isEditMode) {
              <div class="edit-form">
                <div class="form-group">
                  <label>{{ 'dashboard.username' | translate }}</label>
                  <input type="text" [(ngModel)]="editUser.username" class="form-input">
                </div>
                <div class="form-group">
                  <label>{{ 'dashboard.email' | translate }}</label>
                  <input type="email" [(ngModel)]="editUser.email" class="form-input">
                </div>
                <div class="form-group">
                  <label>{{ 'dashboard.age' | translate }}</label>
                  <input type="number" [(ngModel)]="editUser.age" class="form-input">
                </div>
                <div class="form-group">
                  <label>{{ 'dashboard.city' | translate }}</label>
                  <input type="text" [(ngModel)]="editUser.city" class="form-input">
                </div>
                <div class="form-group">
                  <label>{{ 'dashboard.bio' | translate }}</label>
                  <textarea [(ngModel)]="editUser.bio" class="form-textarea" rows="4"></textarea>
                </div>
                <button class="btn-save" (click)="saveProfile()">
                  {{ 'dashboard.saveChanges' | translate }}
                </button>
              </div>
            } @else {
              <div class="info-display">
                <h2>{{ currentUser.username }}</h2>
                <p class="email">{{ currentUser.email }}</p>

                <div class="info-grid">
                  @if (currentUser.age) {
                    <div class="info-item">
                      <span class="info-label">{{ 'dashboard.age' | translate }}:</span>
                      <span class="info-value">{{ currentUser.age }} лет</span>
                    </div>
                  }
                  @if (currentUser.city) {
                    <div class="info-item">
                      <span class="info-label">{{ 'dashboard.city' | translate }}:</span>
                      <span class="info-value">{{ currentUser.city }}</span>
                    </div>
                  }
                  <div class="info-item">
                    <span class="info-label">{{ 'dashboard.joinedDate' | translate }}:</span>
                    <span class="info-value">{{ currentUser.joined_date }}</span>
                  </div>
                </div>

                @if (currentUser.bio) {
                  <div class="bio">
                    <h3>{{ 'dashboard.bio' | translate }}</h3>
                    <p>{{ currentUser.bio }}</p>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </section>

      <!-- Current Reading Section -->
      <section class="reading-section">
        <h2 class="section-title">{{ 'dashboard.currentlyReading' | translate }}</h2>
        @if (currentBook) {
          <div class="current-book-card">
            <img [src]="currentBook.book.cover" [alt]="currentBook.book.title" class="book-cover">
            <div class="book-details">
              <h3>{{ currentBook.book.title }}</h3>
              <p class="author">{{ currentBook.book.author }}</p>
              
              <div class="progress-info">
                <div class="progress-text">
                  <span>{{ 'dashboard.page' | translate }} {{ currentBook.current_page }} {{ 'dashboard.of' | translate }} {{ currentBook.total_pages }}</span>
                  <span class="progress-percent">{{ currentBook.progress }}%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="currentBook.progress"></div>
                </div>
              </div>
              
              <button class="btn-continue" (click)="continueReading()">
                {{ 'dashboard.continueReading' | translate }}
              </button>
            </div>
          </div>
        } @else {
          <div class="empty-state">
            <p>{{ 'dashboard.noCurrentBook' | translate }}</p>
            <button class="btn-primary" routerLink="/search">{{ 'dashboard.findBook' | translate }}</button>
          </div>
        }
      </section>

      <!-- Favorite Books Section -->
      <section class="favorites-section">
        <h2 class="section-title">{{ 'dashboard.favorites' | translate }} ({{ favoriteBooks.length }})</h2>
        @if (favoriteBooks.length > 0) {
          <div class="favorites-grid">
            @for (book of favoriteBooks; track book.id) {
              <div class="favorite-book-card">
                <button class="btn-remove" (click)="removeFromFavorites(book.id)" title="Remove from favorites">
                  ✕
                </button>
                <img [src]="book.book.cover" [alt]="book.book.title" (click)="navigateToBook(book.id)">
                <div class="book-info">
                  <h4 (click)="navigateToBook(book.id)">{{ book.book.title }}</h4>
                  <p>{{ book.book.author }}</p>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">
            <p>{{ 'dashboard.noFavorites' | translate }}</p>
            <button class="btn-primary" routerLink="/search">{{ 'dashboard.findBooks' | translate }}</button>
          </div>
        }
      </section>
    </div>
  }
</div>